trigger:
  branches:
    include:
      - dev
stages:
  - stage: Docker
    displayName: Build & Push Docker image to AWS ECR
    jobs:
      - job: Build_and_Push
        displayName: Build & Push Docker image
        pool:
          vmImage: ubuntu-latest
        steps:
          - task: Docker@2
            displayName: Build an image
            inputs:
              command: build
              dockerfile: '$(Build.SourcesDirectory)/Dockerfile' 
              buildContext: '$(Agent.BuildDirectory)'
              repository: $(DOCKER_REPOSITORY_NAME)

          - task: ECRPushImage@1
            inputs:
              awsCredentials: 'aws-spn'
              regionName: 'us-east-1'
              imageSource: 'imagename'
              sourceImageName: '$(DOCKER_REPOSITORY_NAME):$(Build.BuildId)'
              repositoryName: '$(DOCKER_REPOSITORY_NAME)'